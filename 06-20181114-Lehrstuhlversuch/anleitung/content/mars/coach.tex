\subsection{Coach}%
\label{sub:coach}

Coach trainiert Modelle zur Separation von Signal und Untergrund,
sowie der Rekonstruktion von Energie und Richtung.

\paragraph{Theorie}%

\subparagraph{Gamma/Hadron-Separation}
Für die Analyse einer Quelle ist es wichtig,
das Signal (Gammaschauer) vom
Untergrund (hauptsächlich Protonen) zu separieren.
Da Untergrundevents um mehrere Größenordnungen häufiger auftreten (1:\num{e5}),
geschieht dies durch ein multidimensionales maschinelles
Klassifizierungsystem (Random Forest).

\begin{wrapfigure}[18]{L}{0.55\textwidth}
  \centering
  \includegraphics[width=\linewidth]{build/hadroness.pdf}
  \caption{Schnitte auf der Hadroness und ihre Konsequenzen für die Analyse.}%
  \label{fig:uebersicht}
\end{wrapfigure}

Ziel des Modells ist es, Gammas den Wert 0 und Untergrund den Wert 1 zuzuweisen.
Dazu wird für unabhängige Entscheidungsbäume einer begrenzten Tiefe
der Informationsgehalt maximiert.
Durch Mittelung eines Events über alle trainierten Bäume entsteht ein Wert
zwischen eindeutig Gamma und eindeutig Hadron, welcher als Hadroness bezeichnet
wird.
Durch Schnitte auf diesem Wert kann eine Separation durchgeführt werden.

\subparagraph{Energierekonstruktion}%
\label{par:energie}

Die Energie des Gammas ist beinahe proportional
zur Anzahl der Tscherenkowphotonen
und somit der Photoelektronen in der Kamera,
jedoch hängt die Menge an detektiertem Licht von weiteren Parametern,
wie unter anderem Winkel der Kamera und Lage des Schauers im Kamerabild, ab.

In MARS kann die Energie des Primärteilchens auf zwei Arten rekonstruiert werden:
\begin{description}
	\item[\quad Look-up Tables] Für eine Look-up Table werden Monte Carlo
		Gammas in ausgewählten Parametern gebinnt.
		Diesen Bins wird eine mittlere Energie aller
		zugehörigen Gammas zugewiesen.
		Bei realen Events werden die Parameter mit der Tabelle verglichen
		und so eine Energie geschätzt.
		Es muss darauf geachtet werden,
		dass die Bins möglichst homogen und mit ausreichend Statistik gefüllt sind.
	\item[\quad Random Forest] Außerdem wird eine Random Forest Regression (s.o.)
		zur Bestimmung der Energie durchgeführt.
\end{description}

\subparagraph{Richtungsrekonstruktion}%
\label{par:position}

Die Rekonstruktion der ursprünglich\-en Richtung der Gamma-Ereignisse 
ist eines der Hauptziele, um zu überprüfen, ob das Ereigniss der angenommenen
Quellposition zuzuordnen ist.
Dafür werden nach der ersten Abschätzung in Kapitel~\ref{sub:superstar} weitere
Analyseschritte durchgeführt.
Dazu wird zunächst die \textit{DISP (\textbf{D}istance between the
\textbf{I}mage controid and the \textbf{S}ource \textbf{P}osition)} bestimmt.
Diese gibt die Entfernung vom Schauerschwerpunkt zur rekonstruierten Quellposition
entlang der Hauptachse der Ellipse an (siehe Abbildung~\ref{fig:reco}).
Das Vorzeichen des DISP-Parameters ist nicht bestimmt,
sodass es zwei mögliche Quellpositionen gibt.
Da MAGIC ein Stereoteleskop ist,
kann bei der Schätzung des Vorzeichens des DISP-Parameters
der Schnittpunkt der beiden Hauptachsen als zusätzliche Information
verwendet werden.
Die angenommene rekonstruierte Position ist diejenge, welche näher am
Schnittpunkt der Achsen liegt.
Dadurch wird die Auswirkung von schlecht richtungsrekonstruierten Ereignissen
auf die angenomme Quellposition verringert.
Die Schätzung des DISP-Parameters wird über einen Random-Forest getätigt, 
wo Informationen wie die Momente entlang der Hauptachse oder der Zeitgradient eingehen.
Hadronische Schauer, welche fälschlicherweise die Gamma/Hadron-Separation
überstanden habe, weisen eine kleinere Richtungsgenauigkeit auf, da auf diesen
nicht trainiert wird.
Die Richtungsrekonstruktion vom Untergrund ist jedoch ohne Belangen, solange sie
homogen wie der Untergrund selber verteilt ist.


\paragraph{Durchführung}%
In der \texttt{coach.rc} sind die Pfade
\texttt{RF.mcdata},
\texttt{RF.data},
und \texttt{RF.outpath}
anzupassen.
Es sollen hier die Rootfiles mittels Wildcards angegeben werden
(Bsp.: \texttt{*.root}).
Die Monte Carlo Daten sind in einen Trainingsdatensatz
und einem Testdatensatz aufgeteilt.
Die Trainingsdaten sind durch die Endung
\texttt{*\_wr\_1.root} gekennzeichnet.
Desweiteren ist der Zenit sinnvoll einzustellen.
Es sind die Argumente
\texttt{-RFgh}, \texttt{-LUTs}, und \texttt{-RFdisp}
zum Erstellen eines Random Forest für die Gamma-/Hadron-Separation,
einer Look-Up-Table für die Energieschätzung,
und zwei weiterer Random Forest für die Richtungsrekonstruktion der beiden
Teleskope.

\begin{lstlisting}
  coach -q -b	\
    --config=coach.rc \
    -RFgh \
    -LUTs \
    -RFdisp
  # oder parallel zur schnelleren Rechnung:
  coach -q -b --config=coach.rc -RFgh
  coach -q -b --config=coach.rc -LUTs
  coach -q -b --config=coach.rc -RFdisp
\end{lstlisting}

Es werden vier Dateien erzeugt,
die als weitere Eingangsdaten für die folgenden Analyseschritte verwendet
werden.
Dies sind die beiden Richtungsrekonstruktionen \texttt{DispRF.root},
für die beiden Teleskope, 
in den Ordnern \texttt{disp\{1,2\}}, 
der Random Forest für die Separation
\texttt{RF.root} und die Look-Up-Table \texttt{Energy\_Table.root} für die
Energieschätzung.
